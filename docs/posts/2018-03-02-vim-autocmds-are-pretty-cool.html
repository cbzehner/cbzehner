<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Vim Autocommands are Pretty Cool</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">Chris Zehner</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="https://github.com/cbzehner">Code</a>
                <a href="../thoughts.html">Thoughts</a>
            </nav>
        </header>

        <main role="main">
            <h1>Vim Autocommands are Pretty Cool</h1>
            <article>
    <section class="header">
        Posted on March  2, 2018
        
    </section>
    <section>
        <h2 id="run-tests-with-minimal-effort">Run tests with minimal effort</h2>
<p>I have a mapping in my vim configuration to run tests for the current file I have open using <code>CTRL-t</code>:</p>
<pre><code>map &lt;C-t&gt; :w !t %&lt;CR&gt;</code></pre>
<p>Basically this command says <code>map</code> the combination of the Control key <code>C</code> and the “t” key <code>t</code> to the following command.</p>
<p>First, save the file with <code>:w</code> because there’s no point running tests on the old version of the file.</p>
<p>Then, send the following command <code>t %</code> to the console. <code>!</code> means everything afterwards goes to the console. If I enter just <code>t</code> in my commandline it runs one of my company’s test frameworks and <code>%</code> is replaced with the path of the current file. Pretty handy!</p>
<p>Finally, end the command with the “Carriage Return” <code>&lt;CR&gt;</code>, which is a fancy way of saying “press ENTER!”.</p>
<p>Great! Now I can run tests super easily! But what about if I want to use <code>CTRL-t</code> outside of work?</p>
<h2 id="attempt-to-customize-the-message-per-programming-language">Attempt to customize the message per programming language</h2>
<p>At work I mostly write PHP and Javascript code but for fun I mostly use Haskell and Rust, so maybe I can use a different command based on the file type? I know Vim has a <code>FileType</code> thingy. After a bit of searching I found out <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/21.html">how to do conditionals in Vim</a>. So something like:</p>
<pre><code>if FileType php
    map &lt;C-t&gt; :w !t %&lt;CR&gt;
elseif FileType Rust
    map &lt;C-t&gt; :w !cargo test&lt;CR&gt;
endif</code></pre>
<p>Nope! That doesn’t work like I thought it would at all. I just get this error message:</p>
<pre><code>Error detected while processing /Users/cbzehner/.config/nvim/init.vim:
line    7:
E121: Undefined variable: FileType
E15: Invalid expression: FileType php
line  280:
E171: Missing :endif</code></pre>
<h2 id="enter-autocommands">Enter Autocommands!</h2>
<blockquote>
<p>“Autocommands are a way to tell Vim to run certain commands whenever certain events happen.” - Steve Losh <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/12.html">explains autocommands</a> really well.</p>
</blockquote>
<p>One of the events is a <code>FileType</code> event! Score! So we can just define a bunch of autocommands using the <code>au</code> shorthand:</p>
<pre><code>au FileType php        nnoremap &lt;C-t&gt; :w !t %&lt;CR&gt;
au FileType javascript nnoremap &lt;C-t&gt; :w !jest %&lt;CR&gt;
au FileType rust       nnoremap &lt;C-t&gt; :w !cargo test&lt;CR&gt;
au FileType haskell    nnoremap &lt;C-t&gt; :w !stack test&lt;CR&gt;</code></pre>
<p>This is fantastic! Now we can test any PHP, Javascript, Rust and Haskell with just one command! Could we improve this even more? Yes!</p>
<p>We can use <a href="http://learnvimscriptthehardway.stevelosh.com/chapters/14.html">autocommand groups</a> to prevent duplicate autocommands from causing issues. So let’s take our existing code and wrap it up in an autocommand group.</p>
<pre><code>&quot; Run tests on the current file
augroup testCurrentFile
  au!
  au FileType php           nnoremap &lt;C-t&gt; :w !t %&lt;CR&gt;
  au FileType javascript    nnoremap &lt;C-t&gt; :w !jest %&lt;CR&gt;
  au FileType rust          nnoremap &lt;C-t&gt; :w !cargo test&lt;CR&gt;
  au FileType haskell       nnoremap &lt;C-t&gt; :w !stack test&lt;CR&gt;
augroup END</code></pre>
<p>Awesome! Now we don’t have to worry about duplicate autocommands and we can just use <code>CTRL-t</code> to run tests on a bunch of different file types.</p>
    </section>
</article>

        </main>

        <footer>
            Site lazily generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
